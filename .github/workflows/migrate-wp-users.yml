name: Migrate WordPress Users to Production Clerk

on:
  workflow_dispatch:

jobs:
  migrate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Find WordPress DB credentials on VPS
        uses: appleboy/ssh-action@v1
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USERNAME }}
          password: ${{ secrets.VPS_PASSWORD }}
          script: |
            echo "=== Looking for wp-config.php ==="
            find /var/www -name "wp-config.php" -type f 2>/dev/null | head -5

            echo "=== WP DB credentials ==="
            for f in $(find /var/www -name "wp-config.php" -type f 2>/dev/null); do
              echo "--- $f ---"
              grep -E "DB_NAME|DB_USER|DB_PASSWORD|DB_HOST|table_prefix" "$f" 2>/dev/null | head -10
            done

            echo "=== WordPress databases ==="
            mysql -u u2_uptimekuma_dp7j -pG2prBHnAYJQzahZc -e "SHOW DATABASES;" 2>&1 | head -20 || echo "Cannot list databases"
