name: Debug VPS

on:
  workflow_dispatch:

jobs:
  debug:
    runs-on: ubuntu-latest
    steps:
      - name: Check VPS logs
        uses: appleboy/ssh-action@v1
        with:
          host: ${{ secrets.VPS_HOST }}
          username: ${{ secrets.VPS_USERNAME }}
          password: ${{ secrets.VPS_PASSWORD }}
          script: |
            echo "=== WHO HOLDS PORT 3000 ==="
            sudo ss -tlnp | grep 3000 || true
            sudo lsof -i :3000 2>/dev/null || true
            echo "=== NGINX CONFIG ==="
            sudo cat /etc/nginx/sites-enabled/*clientsupport* 2>/dev/null || true
            sudo grep -r "3000" /etc/nginx/ 2>/dev/null || true
            echo "=== XCLOUD APP CONFIG ==="
            ls -la /var/www/ 2>/dev/null || true
            echo "=== ALL PM2 PROCESSES (ALL USERS) ==="
            sudo pm2 list 2>/dev/null || true
            echo "=== SYSTEMD SERVICES WITH NODE ==="
            systemctl list-units --type=service --all 2>/dev/null | grep -i "node\|next\|pm2\|client" || echo "none found"
